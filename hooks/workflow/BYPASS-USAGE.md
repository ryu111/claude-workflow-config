# Bypass Handler ä½¿ç”¨æŒ‡å—

Escape Hatch æ©Ÿåˆ¶çš„å¯¦ä½œï¼Œå…è¨±ç·Šæ€¥æƒ…æ³ä¸‹è·³éæŸäº›å·¥ä½œæµéšæ®µã€‚

## ğŸ“‹ è¦æ ¼ä¾†æº

- **WORKFLOW-2.0-SPEC.md** ç¬¬å…­ç« ã€ŒEscape Hatchã€

## ğŸ¯ è¨­è¨ˆç›®æ¨™

æä¾›å—æ§çš„å·¥ä½œæµç¹éæ©Ÿåˆ¶ï¼Œå…è¨±åœ¨ç·Šæ€¥æƒ…æ³ä¸‹è·³éæŸäº›éšæ®µï¼ŒåŒæ™‚ä¿æŒå¯è¿½è¹¤æ€§å’Œé˜²æ­¢æ¿«ç”¨ã€‚

## ğŸ”§ ä½¿ç”¨æ–¹å¼

### 1. è«‹æ±‚ Bypass

```bash
node ~/.claude/hooks/workflow/bypass-handler.js bypass "åŸå› "
```

**ç¯„ä¾‹ï¼š**
```bash
node bypass-handler.js bypass "ç·Šæ€¥ä¿®å¾©ï¼Œå·²äººå·¥ç¢ºèª"
```

**æˆåŠŸè¼¸å‡ºï¼š**
```
âœ… Bypass æˆåŠŸï¼šè·³é TEST éšæ®µ
åŸå› ï¼šç·Šæ€¥ä¿®å¾©ï¼Œå·²äººå·¥ç¢ºèª
å‰©é¤˜æ¬¡æ•¸ï¼š2/3
```

**å¤±æ•—æƒ…æ³ï¼š**
```
âŒ Bypass å¤±æ•—ï¼šå·²é”æœ€å¤§æ¬¡æ•¸é™åˆ¶ (3/3)
âŒ Bypass å¤±æ•—ï¼šCOMPLETING éšæ®µä¸å¯è·³é
```

### 2. æŸ¥çœ‹ç‹€æ…‹

```bash
node ~/.claude/hooks/workflow/bypass-handler.js status
```

**è¼¸å‡ºï¼š**
```
ğŸ“Š Bypass ç‹€æ…‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ç•¶å‰éšæ®µï¼šREVIEW
å·²ä½¿ç”¨æ¬¡æ•¸ï¼š1/3
å‰©é¤˜æ¬¡æ•¸ï¼š2

æ­·å²è¨˜éŒ„ï¼š

  1. REVIEW â†’ è·³é TEST
     åŸå› ï¼šç·Šæ€¥ä¿®å¾©ï¼Œå·²äººå·¥ç¢ºèª
     æ™‚é–“ï¼š2026/1/19 ä¸‹åˆ1:25:03

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

### 3. é‡ç½®è¨˜éŒ„

```bash
node ~/.claude/hooks/workflow/bypass-handler.js reset
```

**ä½¿ç”¨æ™‚æ©Ÿï¼š**
- æ–°å·¥ä½œæµé–‹å§‹æ™‚
- æ¸¬è©¦ç’°å¢ƒæ¸…ç†

## ğŸ“Š è¦å‰‡èˆ‡é™åˆ¶

### é™åˆ¶æ¬¡æ•¸

```javascript
MAX_BYPASS_COUNT = 3  // æ¯å€‹å·¥ä½œæµæœ€å¤š 3 æ¬¡
```

### ä¸å¯ Bypass çš„éšæ®µ

```javascript
NON_BYPASSABLE_STATES = ['COMPLETING', 'DONE']
```

**åŸå› ï¼š**
- `COMPLETING`ï¼šæœ€çµ‚æ•´åˆéšæ®µï¼Œè·³éæœƒå°è‡´ä¸å®Œæ•´çš„äº¤ä»˜
- `DONE`ï¼šå·²å®Œæˆï¼Œç„¡éœ€ bypass

### Bypass æµç¨‹

```
ç•¶å‰éšæ®µ â†’ æª¢æŸ¥é™åˆ¶ â†’ è¨˜éŒ„ bypass â†’ æ›´æ–°è¨ˆæ•¸ â†’ è·³éä¸‹ä¸€éšæ®µ
```

## ğŸ“ æª”æ¡ˆçµæ§‹

### ç‹€æ…‹æª”æ¡ˆ

```
~/.claude/workflow-state/current.json
```

**çµæ§‹ï¼š**
```json
{
  "changeId": "change-001",
  "state": "REVIEW",
  "mainAgentOps": {
    "directCode": 0,
    "bypassed": 2
  },
  "metadata": {
    "lastBypass": {
      "state": "REVIEW",
      "skippedState": "TEST",
      "reason": "ç·Šæ€¥ä¿®å¾©",
      "timestamp": "2026-01-19T10:00:00Z"
    }
  }
}
```

### Bypass è¨˜éŒ„æª”æ¡ˆ

```
~/.claude/workflow-state/bypass-records.json
```

**çµæ§‹ï¼š**
```json
{
  "records": [
    {
      "state": "REVIEW",
      "skippedState": "TEST",
      "reason": "ç·Šæ€¥ä¿®å¾©ï¼Œå·²äººå·¥ç¢ºèª",
      "timestamp": "2026-01-19T10:00:00Z"
    },
    {
      "state": "DEV",
      "skippedState": "REVIEW",
      "reason": "æ™‚é–“ç·Šè¿«",
      "timestamp": "2026-01-19T11:00:00Z"
    }
  ]
}
```

## ğŸ”„ å·¥ä½œæµç‹€æ…‹è½‰æ›

```
IDLE â†’ DESIGN â†’ DEV â†’ REVIEW â†’ TEST â†’ COMPLETING â†’ DONE
        â†“       â†“      â†“        â†“        âœ—          âœ—
      bypass  bypass bypass  bypass   ä¸å¯bypass  ä¸å¯bypass
```

## ğŸ§ª æ¸¬è©¦

### åŸ·è¡Œæ¸¬è©¦è…³æœ¬

```bash
~/.claude/hooks/workflow/test-bypass.sh
```

**æ¸¬è©¦é …ç›®ï¼š**
1. âœ… åˆå§‹ç‹€æ…‹æŸ¥è©¢
2. âœ… ç¬¬ä¸€æ¬¡ bypassï¼ˆæˆåŠŸï¼‰
3. âœ… ç¬¬äºŒæ¬¡ bypassï¼ˆæˆåŠŸï¼‰
4. âœ… ç¬¬ä¸‰æ¬¡ bypassï¼ˆæˆåŠŸï¼‰
5. âœ… ç¬¬å››æ¬¡ bypassï¼ˆå¤±æ•— - è¶…éé™åˆ¶ï¼‰
6. âœ… COMPLETING ç‹€æ…‹ bypassï¼ˆå¤±æ•— - ä¸å¯ bypassï¼‰
7. âœ… é‡ç½®åŠŸèƒ½
8. âœ… ç‹€æ…‹æŒä¹…åŒ–

## ğŸ¯ æ•´åˆåˆ°å·¥ä½œæµ

### Hook è§¸ç™¼é»

1. **workflow-gate.js** æª¢æŸ¥ bypass ç‹€æ…‹
2. **state-updater.js** è¨˜éŒ„ bypass äº‹ä»¶
3. **task-sync.js** åŒæ­¥ bypass è³‡è¨Šåˆ°äº‹ä»¶æ—¥èªŒ

### Main Agent ä½¿ç”¨

```bash
# ç”¨æˆ¶å‘½ä»¤
/workflow bypass "ç·Šæ€¥ä¿®å¾©"

# Main Agent åŸ·è¡Œ
node bypass-handler.js bypass "ç·Šæ€¥ä¿®å¾©"

# æª¢æŸ¥çµæœ
if [ $? -eq 0 ]; then
  # å…è¨±è·³é
  continue to next stage
else
  # æ‹’çµ• bypass
  report error to user
fi
```

## ğŸ“ æœ€ä½³å¯¦è¸

### ä½•æ™‚ä½¿ç”¨ Bypass

âœ… **é©åˆä½¿ç”¨ï¼š**
- ç·Šæ€¥å®‰å…¨ä¿®å¾©ï¼ˆå·²ç¶“éäººå·¥ç¢ºèªï¼‰
- æ¸¬è©¦ç’°å¢ƒæ•…éšœï¼Œç„¡æ³•é‹è¡Œè‡ªå‹•åŒ–æ¸¬è©¦
- æ™‚é–“ç·Šè¿«ï¼Œå…ˆä¸Šç·šå†è£œæ¸¬è©¦ï¼ˆæŠ€è¡“å‚µæ˜ç¢ºè¨˜éŒ„ï¼‰

âŒ **ä¸é©åˆä½¿ç”¨ï¼š**
- ã€Œæ‡¶å¾—ç­‰æ¸¬è©¦ã€
- ã€Œæ”¹å‹•å¾ˆå°æ‡‰è©²æ²’å•é¡Œã€
- ã€Œæ¸¬è©¦å¤ªæ…¢ã€
- ç¹é code review

### Bypass åŸå› æ’°å¯«

**å¥½çš„åŸå› ï¼š**
```
"ç·Šæ€¥å®‰å…¨æ¼æ´ä¿®å¾©ï¼Œå·²ç”± John äººå·¥é©—è­‰ï¼Œå¾…æ¸¬è©¦ç’°å¢ƒæ¢å¾©å¾Œè£œæ¸¬"
"ç”Ÿç”¢ç’°å¢ƒæ•…éšœï¼Œhotfix å·²åœ¨ staging æ‰‹å‹•æ¸¬è©¦é€šé"
```

**ä¸å¥½çš„åŸå› ï¼š**
```
"å¿«é»"
"å…ˆä¸Šå†èªª"
"æ”¹å‹•å¾ˆå°"
```

### è¨˜éŒ„æŠ€è¡“å‚µ

Bypass å¾Œæ‡‰è©²ï¼š

1. åœ¨ JIRA/GitHub Issue è¨˜éŒ„æŠ€è¡“å‚µ
2. è¨»æ˜ bypass åŸå› å’Œè£œå„Ÿæªæ–½
3. è¨­å®šè£œå„Ÿå®ŒæˆæœŸé™

```markdown
## æŠ€è¡“å‚µè¨˜éŒ„

- **Bypass æ™‚é–“**ï¼š2026-01-19 13:25
- **è·³ééšæ®µ**ï¼šTEST
- **åŸå› **ï¼šç·Šæ€¥ä¿®å¾©ç”Ÿç”¢ç’°å¢ƒéŒ¯èª¤
- **è£œå„Ÿæªæ–½**ï¼šå¾…æ¸¬è©¦ç’°å¢ƒæ¢å¾©å¾Œè£œå……å®Œæ•´æ¸¬è©¦
- **è² è²¬äºº**ï¼šJohn Doe
- **æœŸé™**ï¼š2026-01-22
```

## ğŸš¨ è­¦å‘Š

### æ¿«ç”¨ Bypass çš„å¾Œæœ

- **å“è³ªä¸‹é™**ï¼šè·³éæ¸¬è©¦å°è‡´ bug ä¸Šç·š
- **æŠ€è¡“å‚µç´¯ç©**ï¼šæœªè£œå„Ÿçš„ bypass è®Šæˆæ°¸ä¹…ç¼ºé™·
- **åœ˜éšŠç¿’æ…£**ï¼šé »ç¹ bypass é™ä½å·¥ä½œæµåƒ¹å€¼

### 3 æ¬¡é™åˆ¶çš„åŸå› 

- **é˜²æ­¢æ¿«ç”¨**ï¼šå¼·è¿«åœ˜éšŠæ€è€ƒæ˜¯å¦çœŸçš„éœ€è¦
- **ä¿æŒå“è³ª**ï¼šå¤§éƒ¨åˆ†éšæ®µä»éœ€ç¶“é
- **å¯è¿½è¹¤æ€§**ï¼šé™åˆ¶æ•¸é‡ä½¿æ¯æ¬¡ bypass éƒ½è¢«é‡è¦–

## ğŸ” ç›£æ§èˆ‡å¯©è¨ˆ

### æŸ¥è©¢ Bypass æ­·å²

```bash
# æŸ¥çœ‹æ‰€æœ‰ bypass è¨˜éŒ„
cat ~/.claude/workflow-state/bypass-records.json | jq '.records'

# çµ±è¨ˆ bypass æ¬¡æ•¸
cat ~/.claude/workflow-state/bypass-records.json | jq '.records | length'

# æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡ bypass
cat ~/.claude/workflow-state/current.json | jq '.metadata.lastBypass'
```

### é€±æœŸæ€§å¯©æŸ¥

å»ºè­°æ¯é€±æª¢è¦–ï¼š
- Bypass ä½¿ç”¨é »ç‡
- Bypass åŸå› æ˜¯å¦åˆç†
- æŠ€è¡“å‚µæ˜¯å¦å·²è£œå„Ÿ

## ğŸ“š ç›¸é—œæ–‡æª”

- **WORKFLOW-2.0-SPEC.md** - å®Œæ•´å·¥ä½œæµè¦æ ¼
- **workflow-gate.js** - å·¥ä½œæµé–˜é–€å¯¦ä½œ
- **state-updater.js** - ç‹€æ…‹æ›´æ–°è™•ç†

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å•é¡Œï¼šæ‰¾ä¸åˆ°ç‹€æ…‹æª”æ¡ˆ

```bash
# æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨
ls -la ~/.claude/workflow-state/

# æ‰‹å‹•å»ºç«‹
mkdir -p ~/.claude/workflow-state
```

### å•é¡Œï¼šæ¬Šé™éŒ¯èª¤

```bash
# ç¢ºä¿ hook å¯åŸ·è¡Œ
chmod +x ~/.claude/hooks/workflow/bypass-handler.js

# ç¢ºä¿ç›®éŒ„å¯å¯«å…¥
chmod 755 ~/.claude/workflow-state
```

### å•é¡Œï¼šJSON æ ¼å¼éŒ¯èª¤

```bash
# é©—è­‰ JSON æ ¼å¼
cat ~/.claude/workflow-state/current.json | jq .

# é‡æ–°åˆå§‹åŒ–ï¼ˆè­¦å‘Šï¼šæœƒæ¸…é™¤è³‡æ–™ï¼‰
rm -rf ~/.claude/workflow-state
mkdir -p ~/.claude/workflow-state
```

## âœ… Checklist

ä½¿ç”¨ Bypass å‰æª¢æŸ¥ï¼š

- [ ] ç¢ºèªæ˜¯å¦çœŸçš„éœ€è¦ bypassï¼ˆä¸æ˜¯åœ–æ–¹ä¾¿ï¼‰
- [ ] æ’°å¯«æ¸…æ¥šçš„ bypass åŸå› 
- [ ] ç¢ºèªæœªè¶…é 3 æ¬¡é™åˆ¶
- [ ] ç¢ºèªç•¶å‰éšæ®µå¯ä»¥ bypass
- [ ] è¨˜éŒ„æŠ€è¡“å‚µå’Œè£œå„Ÿæªæ–½
- [ ] è¨­å®šè£œå„Ÿå®ŒæˆæœŸé™
- [ ] é€šçŸ¥åœ˜éšŠæˆå“¡

Bypass å¾ŒåŸ·è¡Œï¼š

- [ ] æª¢æŸ¥ bypass æ˜¯å¦æˆåŠŸè¨˜éŒ„
- [ ] åœ¨å°ˆæ¡ˆç®¡ç†å·¥å…·å»ºç«‹æŠ€è¡“å‚µ ticket
- [ ] é€šçŸ¥ç›¸é—œäººå“¡
- [ ] è¨­å®šæé†’ä»¥ç¢ºä¿æŠ€è¡“å‚µè¢«å„Ÿé‚„
