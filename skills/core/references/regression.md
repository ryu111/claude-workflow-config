# 回歸測試要求

## 核心規則

```
┌────────────────────────────────────────────────────────────┐
│  T 階段 = 功能測試 + 回歸測試                               │
│                                                            │
│  1️⃣ 功能測試：針對新功能/修改的測試                        │
│  2️⃣ 回歸測試：運行完整測試套件（pytest / npm test）        │
│                                                            │
│  ❌ 只跑功能測試 → 會導致「做 A 壞 B」                       │
│  ✅ 功能 + 回歸 → 確保不破壞現有功能                        │
└────────────────────────────────────────────────────────────┘
```

## 測試執行順序（強制）

```bash
# 1️⃣ 先跑回歸測試（完整測試套件）
pytest                    # Python 專案
npm test                  # Node.js 專案

# 2️⃣ 如果回歸測試失敗
→ 立即停止
→ 報告哪些測試失敗
→ 這是「做 A 壞 B」的問題，必須修復

# 3️⃣ 回歸測試通過後，再跑針對新功能的測試
pytest tests/test_xxx.py -v   # 特定測試
```

## TESTER 必須執行的順序

1. `pytest` (全部) 或 `npm test` → 回歸測試
2. 針對新功能的特定測試 → 功能測試
3. 如果回歸測試失敗 → 立即停止，報告問題

## 測試報告格式

```markdown
## 🧪 測試結果

### 回歸測試
- 總數：XXX tests
- 通過：XXX ✅
- 失敗：XXX ❌（如果有）
- 跳過：XXX ⏭️

### 功能測試
- [新功能測試結果]

### 結論
- ✅ PASS（所有測試通過）
- ❌ FAIL（有測試失敗）
```

## 回歸測試失敗處理

### 發現失敗時

1. **立即停止** - 不要繼續其他任務
2. **報告問題** - 明確指出哪些測試失敗
3. **分析原因** - 是新修改導致的還是預存在問題
4. **修復** - 回到 D 階段修復

### 報告格式

```markdown
## ❌ 回歸測試失敗

### 失敗的測試
- `test_user_login` - AssertionError: expected 200, got 401
- `test_data_export` - TimeoutError

### 分析
這些失敗是由 [本次修改/預存在問題] 導致

### 建議
返回 DEVELOPER 修復後重新測試
```

## 常見錯誤

### ❌ 只跑功能測試

```bash
# 錯誤：只測試新功能
pytest tests/test_new_feature.py

# 正確：先跑完整測試
pytest
pytest tests/test_new_feature.py  # 然後再跑特定測試
```

### ❌ 忽略失敗的測試

```
「這個測試本來就會失敗」→ 不接受
「這不是我的 bug」→ 不接受
```

### ❌ 跳過測試

```bash
# 錯誤：用 -k 排除測試
pytest -k "not slow"

# 正確：跑完整測試，慢的測試也要跑
pytest
```

## 測試覆蓋率目標

| 類型 | 最低 | 理想 |
|------|------|------|
| Unit | 70% | 85%+ |
| Integration | 關鍵路徑 | 所有 API |
| E2E | 關鍵流程 | Happy paths |
