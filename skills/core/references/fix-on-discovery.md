# 發現即修復（Fix-on-Discovery）

## 核心原則

```
┌────────────────────────────────────────────────────────────┐
│  發現問題即修復，不分任務範圍                               │
│                                                            │
│  ❌「不是我的 bug」                                         │
│  ❌「預存在問題」                                           │
│  ❌「不在範圍」                                             │
│  ❌「這是別人的責任」                                       │
│                                                            │
│  ✅ 發現 = 責任                                             │
└────────────────────────────────────────────────────────────┘
```

## 為什麼這個規則很重要？

### 問題累積效應

```
第 1 次：「不是我的 bug，跳過」
第 2 次：「之前就有，跳過」
第 3 次：「不在範圍，跳過」
    ↓
結果：問題永遠不會被修復
```

### 專業態度

專業工程師看到問題就修復，不找藉口。

## 適用情境

### 1. 類型錯誤（Type Errors）

```bash
# 執行類型檢查
pyright src/

# 發現錯誤
error: Type "str" cannot be assigned to type "int"
```

**正確做法**：立即修復，不管是誰造成的。

### 2. Lint 警告

```bash
# 執行 lint
eslint src/

# 發現警告
warning: 'foo' is defined but never used
```

**正確做法**：立即清理。

### 3. 測試失敗

```bash
# 執行測試
pytest

# 發現失敗
FAILED tests/test_api.py::test_login
```

**正確做法**：立即修復，即使是「預存在」的失敗。

### 4. 程式碼異味（Code Smells）

在閱讀程式碼時發現：
- 重複程式碼
- 過長函數
- 魔術數字

**正確做法**：順手修復，不留技術債。

## 例外情況

只有以下情況可以「暫緩」修復：

1. **修復範圍過大**：需要獨立任務處理
   - 行動：建立 Issue/Task 追蹤，不是忽略

2. **需要更多資訊**：不確定正確的修復方式
   - 行動：詢問用戶或查閱文檔

3. **破壞性變更**：修復可能影響其他功能
   - 行動：先進行影響分析

## Hook 提醒機制

當執行類型檢查/lint 工具時，`fix-on-discovery.sh` Hook 會自動檢測錯誤並提醒：

```
⚠️ 發現 3 個類型/lint 錯誤。

🔴 Core Rule #2: 發現問題即修復，不分任務範圍
❌「不是我的 bug」 ❌「預存在問題」 ❌「不在範圍」

請立即修復這些錯誤，不要跳過。
```

## 職責分工

| Agent | 發現問題時 |
|-------|-----------|
| DEVELOPER | 直接修復 |
| REVIEWER | 指出問題，要求 DEVELOPER 修復 |
| TESTER | 報告問題，要求修復後重測 |
| Main Agent | 協調修復，不忽略 |

**重點**：不管哪個 Agent 發現問題，都不能忽略。

## 檢查清單

每次發現問題時，問自己：

- [ ] 這個問題會影響程式碼品質嗎？→ 是 → 修復
- [ ] 這個問題會在未來造成困擾嗎？→ 是 → 修復
- [ ] 我能在合理時間內修復嗎？→ 是 → 修復
- [ ] 修復是否需要更多資訊？→ 是 → 詢問後修復
